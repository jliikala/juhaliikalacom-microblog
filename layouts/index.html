{{ define "main" }}
<section class="posts" id="post-list">
  {{ if or .IsHome .Site.Params.paginate_categories }}
    {{ $paginator := .Paginate (where .Site.Pages.ByDate.Reverse "Type" "post") }}
    {{ $hidden_posts := where $paginator "Params.categories" "intersect" (slice "featured") }}
    {{ $paginator = $paginator | symdiff $hidden_posts }}
    {{ $list := $paginator.Pages }}
    {{ if .Site.Taxonomies.categories.featured }}
      {{ range first 1 .Site.Taxonomies.categories.featured }}
        {{ partial "featured-post-item.html" . }}
      {{ end }}
    {{ end }}
    {{ range $list  }}
      {{ partial "post-item.html" . }}
    {{ end }}
  {{ else }}
    {{ $list := where .Site.Pages.ByDate.Reverse "Type" "post" }}
    {{ range $list  }}
      {{ partial "post-item.html" . }}
    {{ end }}
  {{ end }}
</section>
{{ if .IsHome }}
    {{ if .Site.Params.paginate_home }}
      {{ partial "pagination" . }}
    {{ end }}
  {{ else if .Site.Params.paginate_categories }}
    {{ partial "pagination" . }}
  {{ end }}
{{ end }}